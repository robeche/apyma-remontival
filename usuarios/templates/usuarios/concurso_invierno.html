{% extends 'usuarios/base.html' %}
{% load i18n %}

{% block title %}{% trans "Concurso de Dibujo - D√≠a de invierno - Apyma Remontival" %}{% endblock %}

{% block extra_css %}
<style>
    /* Fondo invernal */
    body {
        background: linear-gradient(180deg, #e3f2fd 0%, #ffffff 100%);
    }

    /* Animaci√≥n de nieve */
    @keyframes snowfall {
        0% {
            top: -10%;
            opacity: 0.8;
        }
        100% {
            top: 100%;
            opacity: 0;
        }
    }

    .snowflake {
        position: fixed;
        top: -10%;
        z-index: 9999;
        user-select: none;
        cursor: default;
        animation: snowfall linear infinite;
        color: #b3d9ff;
        font-size: 1.5em;
        text-shadow: 0 0 5px rgba(179, 217, 255, 0.8);
        pointer-events: none;
    }

    /* T√≠tulo decorado */
    .winter-title {
        background: linear-gradient(135deg, #1976d2 0%, #64b5f6 50%, #bbdefb 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        animation: shimmer 3s ease-in-out infinite;
    }

    @keyframes shimmer {
        0%, 100% { filter: brightness(1); }
        50% { filter: brightness(1.2); }
    }

    /* Tarjetas con borde invernal */
    .winter-card {
        border: 3px solid transparent;
        border-image: linear-gradient(45deg, #1976d2, #64b5f6, #e3f2fd) 1;
        box-shadow: 0 4px 20px rgba(25, 118, 210, 0.3);
        position: relative;
        overflow: visible;
        background: rgba(255, 255, 255, 0.95);
    }

    .winter-card::before {
        content: "‚ùÑÔ∏è";
        position: absolute;
        top: -15px;
        left: 10px;
        font-size: 2rem;
        z-index: 1;
    }

    .winter-card::after {
        content: "‚õ∑Ô∏è";
        position: absolute;
        top: -15px;
        right: 10px;
        font-size: 2rem;
        z-index: 1;
    }

    /* Bot√≥n invernal animado */
    .btn-winter {
        background: linear-gradient(135deg, #1976d2 0%, #64b5f6 100%);
        border: none;
        color: white;
        font-weight: bold;
        box-shadow: 0 4px 15px rgba(25, 118, 210, 0.4);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .btn-winter:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(25, 118, 210, 0.6);
        background: linear-gradient(135deg, #64b5f6 0%, #1976d2 100%);
        color: white;
    }

    .btn-winter::before {
        content: "‚ùÑÔ∏è";
        position: absolute;
        left: -20px;
        animation: sparkle 2s linear infinite;
    }

    @keyframes sparkle {
        0%, 100% { left: -20px; opacity: 0; }
        50% { left: 50%; opacity: 1; }
    }

    /* Decoraciones en las esquinas */
    .corner-decoration {
        position: fixed;
        font-size: 4rem;
        opacity: 0.3;
        z-index: 1;
        pointer-events: none;
    }

    .corner-decoration.top-left {
        top: 80px;
        left: 20px;
    }

    .corner-decoration.top-right {
        top: 80px;
        right: 20px;
    }

    .corner-decoration.bottom-left {
        bottom: 20px;
        left: 20px;
    }

    .corner-decoration.bottom-right {
        bottom: 20px;
        right: 20px;
    }

    /* Efecto en el carrusel */
    .carousel-inner {
        background: linear-gradient(135deg, #f8f9fa 0%, #fff 50%, #e3f2fd 100%);
        border-radius: 10px;
    }

    /* Luces invernales */
    @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.3; }
    }

    .winter-lights {
        display: flex;
        justify-content: space-around;
        padding: 10px 0;
        margin-bottom: 20px;
    }

    .light {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        animation: blink 1.5s infinite;
    }

    .light:nth-child(1) { background: #1976d2; animation-delay: 0s; }
    .light:nth-child(2) { background: #64b5f6; animation-delay: 0.3s; }
    .light:nth-child(3) { background: #bbdefb; animation-delay: 0.6s; }
    .light:nth-child(4) { background: #90caf9; animation-delay: 0.9s; }
    .light:nth-child(5) { background: #1976d2; animation-delay: 1.2s; }
    
    .bases-list {
        list-style: none;
        padding-left: 0;
    }
    
    .bases-list li {
        padding: 0.75rem 0;
        border-bottom: 1px solid #e3f2fd;
    }
    
    .bases-list li:last-child {
        border-bottom: none;
    }
    
    .bases-title {
        font-weight: bold;
        color: #1976d2;
        margin-bottom: 0.5rem;
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<!-- Decoraciones en las esquinas -->
<div class="corner-decoration top-left">‚ùÑÔ∏è</div>
<div class="corner-decoration top-right">‚õÑ</div>
<div class="corner-decoration bottom-left">üéø</div>
<div class="corner-decoration bottom-right">üèîÔ∏è</div>

<!-- Copos de nieve -->
<div class="snowflake" style="left: 10%; animation-duration: 10s;">‚ùÑ</div>
<div class="snowflake" style="left: 20%; animation-duration: 12s; animation-delay: 1s;">‚ùÖ</div>
<div class="snowflake" style="left: 30%; animation-duration: 15s; animation-delay: 2s;">‚ùÜ</div>
<div class="snowflake" style="left: 40%; animation-duration: 13s; animation-delay: 0.5s;">‚ùÑ</div>
<div class="snowflake" style="left: 50%; animation-duration: 11s; animation-delay: 1.5s;">‚ùÖ</div>
<div class="snowflake" style="left: 60%; animation-duration: 14s; animation-delay: 2.5s;">‚ùÜ</div>
<div class="snowflake" style="left: 70%; animation-duration: 12s; animation-delay: 1s;">‚ùÑ</div>
<div class="snowflake" style="left: 80%; animation-duration: 16s; animation-delay: 0s;">‚ùÖ</div>
<div class="snowflake" style="left: 90%; animation-duration: 13s; animation-delay: 3s;">‚ùÜ</div>

<div class="container">
    <!-- Luces invernales -->
    <div class="winter-lights">
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
    </div>

    <h1 class="mb-4 text-center winter-title" style="font-size: 3rem;">
        ‚ùÑÔ∏è <i class="bi bi-palette"></i> {% trans "Concurso de Dibujo: Un d√≠a de invierno" %} ‚òÉÔ∏è
    </h1>

    <div class="alert alert-primary text-center mx-auto mb-5" style="max-width: 800px; border: none; background: linear-gradient(135deg, rgba(25, 118, 210, 0.1) 0%, rgba(100, 181, 246, 0.1) 100%); border-left: 4px solid #1976d2;">
        <p class="mb-0" style="font-size: 1.1rem; color: #1565c0;">
            <i class="bi bi-info-circle-fill me-2"></i>
            {% trans "Desde Apyma Remontival hemos organizado un concurso de dibujo para nuestras y nuestros peque√±os artistas. ¬°An√≠mate a participar y demuestra tu creatividad con el tema 'Un d√≠a de invierno'!" %}
        </p>
    </div>

    <!-- Botones de acci√≥n -->
    <div class="text-center mb-5">
        <button type="button" class="btn btn-winter btn-lg px-4 py-3 me-3" data-bs-toggle="modal" data-bs-target="#basesModal" style="font-size: 1.3rem;">
            üìã <i class="bi bi-file-text me-2"></i>{% trans "Ver bases del concurso" %}
        </button>
        <button type="button" class="btn btn-winter btn-lg px-4 py-3" data-bs-toggle="modal" data-bs-target="#formularioModal" style="font-size: 1.3rem;">
            üé® <i class="bi bi-pencil-square me-2"></i>{% trans "¬øQuieres participar?" %} ‚ùÑÔ∏è
        </button>
    </div>

    <!-- Carrousel de dibujos aceptados -->
    {% if dibujos_aceptados %}
    <div class="card mb-4 shadow winter-card">
        <div class="card-body">
            <h5 class="card-title text-center mb-4" style="color: #1976d2; font-weight: bold;">
                üé® <i class="bi bi-images"></i> {% trans "Dibujos participantes" %} üñçÔ∏è
            </h5>
            <div id="carouselDibujos" class="carousel slide carousel-dark" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    {% for dibujo in dibujos_aceptados %}
                    <button type="button" data-bs-target="#carouselDibujos" data-bs-slide-to="{{ forloop.counter0 }}" 
                            {% if forloop.first %}class="active" aria-current="true"{% endif %} 
                            aria-label="Slide {{ forloop.counter }}"></button>
                    {% endfor %}
                </div>
                <div class="carousel-inner" style="min-height: 400px;">
                    {% for dibujo in dibujos_aceptados %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        <div class="d-flex justify-content-center align-items-center" style="min-height: 400px; background-color: #f8f9fa;">
                            <img src="{{ dibujo.imagen.url }}" class="img-fluid" alt="Dibujo invernal" 
                                 style="max-height: 600px; max-width: 100%; object-fit: contain;">
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselDibujos" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">{% trans "Anterior" %}</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselDibujos" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">{% trans "Siguiente" %}</span>
                </button>
            </div>
            <p class="text-center text-muted mt-3 mb-0">
                <small>{{ dibujos_aceptados.count }} {% trans "dibujo(s) participante(s)" %}</small>
            </p>
        </div>
    </div>
    {% else %}
    <div class="alert alert-info text-center" role="alert">
        <i class="bi bi-info-circle me-2"></i>
        {% trans "A√∫n no hay dibujos publicados. ¬°S√© el primero en participar!" %}
    </div>
    {% endif %}
</div>

<!-- Modal de bases del concurso -->
<div class="modal fade" id="basesModal" tabindex="-1" aria-labelledby="basesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #1976d2 0%, #64b5f6 100%); color: white;">
                <h5 class="modal-title" id="basesModalLabel">
                    <i class="bi bi-file-text me-2"></i>{% trans "Bases del Concurso de Dibujo: Un d√≠a de invierno" %}
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul class="bases-list">
                    <li>
                        <span class="bases-title">1¬™ {% trans "Participantes" %}</span>
                        {% trans "Podr√° participar todo el alumnado del centro escolar, que la familia sea socia de Apyma." %}
                    </li>
                    <li>
                        <span class="bases-title">2¬™ {% trans "Tem√°tica" %}</span>
                        {% trans "El tema central del concurso ser√° 'Un d√≠a de invierno'. Los dibujos deber√°n reflejar una interpretaci√≥n personal y original de esta tem√°tica." %}
                    </li>
                    <li>
                        <span class="bases-title">3¬™ {% trans "T√©cnica y formato" %}</span>
                        {% trans "Los trabajos deben ser originales e in√©ditos. Se puede utilizar cualquier t√©cnica de dibujo o pintura (l√°pices de colores, ceras, acuarelas, temperas, etc.) incluso digital." %}
                    </li>
                    <li>
                        <span class="bases-title">4¬™ {% trans "Presentaci√≥n e identificaci√≥n" %}</span>
                        {% trans "Cada estudiante podr√° presentar un solo dibujo. Los datos del participante (nombre y apellidos, edad, curso, clase) deben indicarse en el reverso del dibujo, no en el anverso." %}
                    </li>
                    <li>
                        <span class="bases-title">5¬™ {% trans "Plazo y lugar de entrega" %}</span>
                        {% trans "El plazo de presentaci√≥n de los dibujos ser√° desde el 20 de Diciembre hasta el 6 de Enero. Los trabajos se subir√°n a trav√©s de esta p√°gina web. No se admitir√°n obras fuera de plazo." %}
                    </li>
                    <li>
                        <span class="bases-title">6¬™ {% trans "Jurado y criterios de valoraci√≥n" %}</span>
                        {% trans "El jurado estar√° compuesto por miembros de la Apyma. Se valorar√°n la creatividad, la originalidad, la composici√≥n y la aplicaci√≥n de la t√©cnica. El fallo del jurado ser√° inapelable y se har√° p√∫blico el 9 de Enero en la p√°gina web." %}
                    </li>
                    <li>
                        <span class="bases-title">7¬™ {% trans "Premios" %}</span>
                        {% trans "Se otorgar√° un premio por curso:" %}
                        <ul style="margin-top: 10px; list-style-type: disc; padding-left: 20px;">
                            <li><strong>1¬∫ Educaci√≥n Infantil:</strong> Cuadros para rascar grandes animales</li>
                            <li><strong>2¬∫ Educaci√≥n Infantil:</strong> Cartas Bata-Miaou</li>
                            <li><strong>3¬∫ Educaci√≥n Infantil:</strong> Demasiados malvados</li>
                            <li><strong>1¬∫ Primaria:</strong> Flippin Dolphins</li>
                            <li><strong>2¬∫ Primaria:</strong> Turbo Reader</li>
                            <li><strong>3¬∫ Primaria:</strong> Cartas Bogoos</li>
                            <li><strong>4¬∫ Primaria:</strong> Los hombres lobo de Castronegro</li>
                            <li><strong>5¬∫ Primaria:</strong> IQ Bubbles</li>
                            <li><strong>6¬∫ Primaria:</strong> Exploding Kittens</li>
                        </ul>
                    </li>
                    <li>
                        <span class="bases-title">8¬™ {% trans "Propiedad intelectual y difusi√≥n" %}</span>
                        {% trans "Los dibujos presentados quedar√°n en propiedad de Apyma, que se reserva el derecho de utilizarlos, reproducirlos o exponerlos (siempre mencionando al autor/a) con fines no comerciales. La participaci√≥n en el concurso implica la aceptaci√≥n de estas bases." %}
                    </li>
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i>{% trans "Cerrar" %}
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal del formulario -->
<div class="modal fade" id="formularioModal" tabindex="-1" aria-labelledby="formularioModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #1976d2 0%, #64b5f6 100%); color: white;">
                <h5 class="modal-title" id="formularioModalLabel">
                    <i class="bi bi-upload me-2"></i>{% trans "Enviar participaci√≥n" %}
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" enctype="multipart/form-data" id="formConcurso">
                    {% csrf_token %}
                    {{ form.non_field_errors }}

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="bi bi-image"></i> {% trans "Fotograf√≠a del dibujo" %}
                        </label>
                        {{ form.imagen }}
                        {% for err in form.imagen.errors %}
                            <div class="text-danger small">{{ err }}</div>
                        {% endfor %}
                    </div>

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="bi bi-person"></i> {% trans "Nombre del ni√±o" %}
                        </label>
                        {{ form.nombre_nino }}
                        {% for err in form.nombre_nino.errors %}
                            <div class="text-danger small">{{ err }}</div>
                        {% endfor %}
                    </div>

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="bi bi-book"></i> {% trans "Curso" %}
                        </label>
                        {{ form.curso }}
                        {% for err in form.curso.errors %}
                            <div class="text-danger small">{{ err }}</div>
                        {% endfor %}
                    </div>

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="bi bi-envelope"></i> {% trans "Correo electr√≥nico (socio)" %}
                        </label>
                        {{ form.email }}
                        <small class="form-text text-muted">{% trans "Email del padre/madre socio de la Apyma" %}</small>
                        {% for err in form.email.errors %}
                            <div class="text-danger small">{{ err }}</div>
                        {% endfor %}
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x-circle me-1"></i>{% trans "Cancelar" %}
                        </button>
                        <button class="btn btn-winter" type="submit">
                            <i class="bi bi-send me-1"></i>{% trans "Enviar participaci√≥n" %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de confirmaci√≥n -->
<div class="modal fade" id="confirmacionModal" tabindex="-1" aria-labelledby="confirmacionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #1976d2 0%, #64b5f6 100%); color: white;">
                <h5 class="modal-title" id="confirmacionModalLabel">
                    <i class="bi bi-check-circle-fill me-2"></i>{% trans "¬°Participaci√≥n recibida!" %}
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <i class="bi bi-palette" style="font-size: 4rem; color: #1976d2;"></i>
                <h4 class="mt-3">{% trans "¬°Gracias por participar!" %}</h4>
                <p class="text-muted">
                    {% trans "Tu dibujo se ha recibido correctamente." %}
                </p>
                <div class="alert alert-info mt-3" role="alert">
                    <i class="bi bi-clock-history me-2"></i>
                    <strong>{% trans "Tu dibujo ser√° revisado antes de a√±adirse a la galer√≠a, pero aparecer√° a lo largo del d√≠a." %}</strong>
                </div>
                <p class="text-muted small">
                    {% trans "Recuerda: habr√° un premio por curso. El fallo del jurado se publicar√° el 9 de Enero." %}
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-winter" data-bs-dismiss="modal">
                    <i class="bi bi-check2 me-1"></i>{% trans "Cerrar" %}
                </button>
            </div>
        </div>
    </div>
</div>

{% if mostrar_modal %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var modal = new bootstrap.Modal(document.getElementById('confirmacionModal'));
        modal.show();
    });
</script>
{% endif %}
{% endblock %}
