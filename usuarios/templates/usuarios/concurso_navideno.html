{% extends 'usuarios/base.html' %}
{% load i18n %}

{% block title %}{% trans "Concurso navide√±o - Apyma Remontival" %}{% endblock %}

{% block extra_css %}
<style>
    /* Fondo navide√±o */
    body {
        background: linear-gradient(180deg, #f8f9fa 0%, #e3f2fd 100%);
    }

    /* Animaci√≥n de nieve */
    @keyframes snowfall {
        0% {
            top: -10%;
            opacity: 0.8;
        }
        100% {
            top: 100%;
            opacity: 0;
        }
    }

    .snowflake {
        position: fixed;
        top: -10%;
        z-index: 9999;
        user-select: none;
        cursor: default;
        animation: snowfall linear infinite;
        color: #fff;
        font-size: 1.5em;
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
        pointer-events: none;
    }

    /* T√≠tulo decorado */
    .christmas-title {
        background: linear-gradient(135deg, #c41e3a 0%, #0c7c59 50%, #c41e3a 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        animation: shimmer 3s ease-in-out infinite;
    }

    @keyframes shimmer {
        0%, 100% { filter: brightness(1); }
        50% { filter: brightness(1.2); }
    }

    /* Tarjetas con borde navide√±o */
    .christmas-card {
        border: 3px solid transparent;
        border-image: linear-gradient(45deg, #c41e3a, #0c7c59, #ffd700) 1;
        box-shadow: 0 4px 20px rgba(196, 30, 58, 0.3);
        position: relative;
        overflow: visible;
    }

    .christmas-card::before {
        content: "üéÑ";
        position: absolute;
        top: -15px;
        left: 10px;
        font-size: 2rem;
        z-index: 1;
    }

    .christmas-card::after {
        content: "‚õÑ";
        position: absolute;
        top: -15px;
        right: 10px;
        font-size: 2rem;
        z-index: 1;
    }

    /* Bot√≥n navide√±o animado */
    .btn-christmas {
        background: linear-gradient(135deg, #c41e3a 0%, #0c7c59 100%);
        border: none;
        color: white;
        font-weight: bold;
        box-shadow: 0 4px 15px rgba(196, 30, 58, 0.4);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .btn-christmas:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(196, 30, 58, 0.6);
        background: linear-gradient(135deg, #0c7c59 0%, #c41e3a 100%);
        color: white;
    }

    .btn-christmas::before {
        content: "‚ú®";
        position: absolute;
        left: -20px;
        animation: sparkle 2s linear infinite;
    }

    @keyframes sparkle {
        0%, 100% { left: -20px; opacity: 0; }
        50% { left: 50%; opacity: 1; }
    }

    /* Decoraciones en las esquinas */
    .corner-decoration {
        position: fixed;
        font-size: 4rem;
        opacity: 0.3;
        z-index: 1;
        pointer-events: none;
    }

    .corner-decoration.top-left {
        top: 80px;
        left: 20px;
    }

    .corner-decoration.top-right {
        top: 80px;
        right: 20px;
    }

    .corner-decoration.bottom-left {
        bottom: 20px;
        left: 20px;
    }

    .corner-decoration.bottom-right {
        bottom: 20px;
        right: 20px;
    }

    /* Efecto brillante en el carrusel */
    .carousel-inner {
        background: linear-gradient(135deg, #f8f9fa 0%, #fff 50%, #f8f9fa 100%);
        border-radius: 10px;
    }

    /* Luces navide√±as */
    @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.3; }
    }

    .christmas-lights {
        display: flex;
        justify-content: space-around;
        padding: 10px 0;
        margin-bottom: 20px;
    }

    .light {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        animation: blink 1.5s infinite;
    }

    .light:nth-child(1) { background: #c41e3a; animation-delay: 0s; }
    .light:nth-child(2) { background: #0c7c59; animation-delay: 0.3s; }
    .light:nth-child(3) { background: #ffd700; animation-delay: 0.6s; }
    .light:nth-child(4) { background: #4169e1; animation-delay: 0.9s; }
    .light:nth-child(5) { background: #c41e3a; animation-delay: 1.2s; }
</style>
{% endblock %}

{% block content %}
<!-- Decoraciones en las esquinas -->
<div class="corner-decoration top-left">üéÑ</div>
<div class="corner-decoration top-right">‚õÑ</div>
<div class="corner-decoration bottom-left">üéÅ</div>
<div class="corner-decoration bottom-right">üîî</div>

<!-- Copos de nieve -->
<div class="snowflake" style="left: 10%; animation-duration: 10s;">‚ùÑ</div>
<div class="snowflake" style="left: 20%; animation-duration: 12s; animation-delay: 1s;">‚ùÖ</div>
<div class="snowflake" style="left: 30%; animation-duration: 15s; animation-delay: 2s;">‚ùÜ</div>
<div class="snowflake" style="left: 40%; animation-duration: 13s; animation-delay: 0.5s;">‚ùÑ</div>
<div class="snowflake" style="left: 50%; animation-duration: 11s; animation-delay: 1.5s;">‚ùÖ</div>
<div class="snowflake" style="left: 60%; animation-duration: 14s; animation-delay: 2.5s;">‚ùÜ</div>
<div class="snowflake" style="left: 70%; animation-duration: 12s; animation-delay: 1s;">‚ùÑ</div>
<div class="snowflake" style="left: 80%; animation-duration: 16s; animation-delay: 0s;">‚ùÖ</div>
<div class="snowflake" style="left: 90%; animation-duration: 13s; animation-delay: 3s;">‚ùÜ</div>

<div class="container">
    <!-- Luces navide√±as -->
    <div class="christmas-lights">
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div christmas-card">
        <div class="card-body">
            <h5 class="card-title text-center mb-4" style="color: #c41e3a; font-weight: bold;">
                üé® <i class="bi bi-images"></i> {% trans "Dibujos participantes" %} üñçÔ∏è
        üéÖ <i class="bi bi-gift"></i> {% trans "Concurso navide√±o" %} üéÑ
    </h1>

    <!-- Carrousel de dibujos aceptados -->
    {% if dibujos_aceptados %}
    <div class="card mb-4 shadow">
        <div class="card-body">
            <h5 class="card-title text-center mb-4">
                <i class="bi bi-images"></i> {% trans "Dibujos participantes" %}
            </h5>
            <div id="carouselDibujos" class="carousel slide carousel-dark" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    {% for dibujo in dibujos_aceptados %}
                    <button type="button" data-bs-target="#carouselDibujos" data-bs-slide-to="{{ forloop.counter0 }}" 
                            {% if forloop.first %}class="active" aria-current="true"{% endif %} 
                            aria-label="Slide {{ forloop.counter }}"></button>
                    {% endfor %}
                </div>
                <div class="carousel-inner" style="min-height: 400px;">
                    {% for dibujo in dibujos_aceptados %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        <div class="d-flex justify-content-center align-items-center" style="min-height: 400px; background-color: #f8f9fa;">
                            <img src="{{ dibujo.imagen.url }}" class="img-fluid" alt="Dibujo navide√±o" 
                                 style="max-height: 600px; max-width: 100%; object-fit: contain;">
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselDibujos" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">{% trans "Anterior" %}</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselDibujos" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">{% trans "Siguiente" %}</span>
                </button>
            </div>
            <p class="text-center text-muted mt-3 mb-0">
                <small>{{ dibujos_aceptados.count }} {% trans "dibujo(s) participante(s)" %}</small>
            </p>
        </div>
    </div>
    {% else %}
    <div class="alert alert-info text-center" role="alert">
        <i class="bi bi-info-circle me-2"></i>
        {% trans "A√∫n no hay dibujos publicados. ¬°S√© el primero en participar!" %}
    </div>
    {% endif %}

    <!-- Bases del concurso -->
    <div class="card mb-4 christmas-card">
        <div class="card-body">
            <h5 class="card-title" style="color: #0c7c59; font-weight: bold;">
                üìã {% trans "Bases" %} ‚ú®
            </h5>
            <ul>
                <li>{% trans "Imprescindible ser miembro de la apyma para poder participar" %}</li>
                <li>{% trans "Un dibujo por ni√±o/a" %}</li>
                <li>{% trans "Habr√° un regalo por curso" %}</li>
            </ul>
            <p class="text-muted small">
                <i class="bi bi-info-circle"></i> 
                {% trans "Completa el formulario con los datos del ni√±o/a y sube una foto clara del dibujo navide√±o. Si tienes varios hijos, puedes enviar un dibujo por cada uno." %}
            </p>
        </div>
    </div>

    <!-- Bot√≥n para abrir el modal -->
    <div class="text-center mb-5">
        <button type="button" class="btn btn-christmas btn-lg px-5 py-3" data-bs-toggle="modal" data-bs-target="#formularioModal" style="font-size: 1.3rem;">
            üé® <i class="bi bi-pencil-square me-2"></i>{% trans "¬øQuieres participar?" %} üéÑ
        </button>
    </div>
</div>

<!-- Modal del formulario -->
<div class="modal fade" id="formularioModal" tabindex="-1" aria-labelledby="formularioModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #dc3545 0%, #28a745 100%); color: white;">
                <h5 class="modal-title" id="formularioModalLabel">
                    <i class="bi bi-upload me-2"></i>{% trans "Enviar participaci√≥n" %}
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" enctype="multipart/form-data" id="formConcurso">
                    {% csrf_token %}
                    {{ form.non_field_errors }}

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="bi bi-image"></i> {% trans "Fotograf√≠a del dibujo" %}
                        </label>
                        {{ form.imagen }}
                        {% for err in form.imagen.errors %}
                            <div class="text-danger small">{{ err }}</div>
                        {% endfor %}
                    </div>

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="bi bi-person"></i> {% trans "Nombre del ni√±o" %}
                        </label>
                        {{ form.nombre_nino }}
                        {% for err in form.nombre_nino.errors %}
                            <div class="text-danger small">{{ err }}</div>
                        {% endfor %}
                    </div>

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="bi bi-book"></i> {% trans "Curso" %}
                        </label>
                        {{ form.curso }}
                        {% for err in form.curso.errors %}
                            <div class="text-danger small">{{ err }}</div>
                        {% endfor %}
                    </div>

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="bi bi-envelope"></i> {% trans "Correo electr√≥nico (socio)" %}
                        </label>
                        {{ form.email }}
                        <small class="form-text text-muted">{% trans "Email del padre/madre socio de la Apyma" %}</small>
                        {% for err in form.email.errors %}
                            <div class="text-danger small">{{ err }}</div>
                        {% endfor %}
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x-circle me-1"></i>{% trans "Cancelar" %}
                        </button>
                        <button class="btn btn-primary" type="submit">
                            <i class="bi bi-send me-1"></i>{% trans "Enviar participaci√≥n" %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de confirmaci√≥n -->
<div class="modal fade" id="confirmacionModal" tabindex="-1" aria-labelledby="confirmacionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white;">
                <h5 class="modal-title" id="confirmacionModalLabel">
                    <i class="bi bi-check-circle-fill me-2"></i>{% trans "¬°Participaci√≥n recibida!" %}
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <i class="bi bi-gift" style="font-size: 4rem; color: #28a745;"></i>
                <h4 class="mt-3">{% trans "¬°Gracias por participar!" %}</h4>
                <p class="text-muted">
                    {% trans "Tu dibujo navide√±o se ha recibido correctamente." %}
                </p>
                <div class="alert alert-info mt-3" role="alert">
                    <i class="bi bi-clock-history me-2"></i>
                    <strong>{% trans "Tu dibujo ser√° revisado antes de a√±adirse al museo, pero aparecer√° a lo largo del d√≠a." %}</strong>
                </div>
                <p class="text-muted small">
                    {% trans "Recuerda: habr√° un regalo por curso" %}
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" data-bs-dismiss="modal">
                    <i class="bi bi-check2 me-1"></i>{% trans "Cerrar" %}
                </button>
            </div>
        </div>
    </div>
</div>

{% if mostrar_modal %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var modal = new bootstrap.Modal(document.getElementById('confirmacionModal'));
        modal.show();
    });
</script>
{% endif %}
{% endblock %}
