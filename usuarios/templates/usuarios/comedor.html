{% extends 'usuarios/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Comedor Escolar" %} - {% trans "Apyma Remontival" %}{% endblock %}

{% block content %}
<style>
    .pdf-iframe {
        width: 100%;
        height: 100%;
        border: 1px solid #ddd;
        border-radius: 0.375rem;
    }
    
    .ratio-4x3 {
        min-height: 600px;
    }
    
    @media (max-width: 768px) {
        .ratio-4x3 {
            min-height: 400px;
        }
    }
</style>

<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h2 mb-0">
                <i class="bi bi-cup-hot me-2 text-warning"></i>
                {% trans "Comedor Escolar" %}
            </h1>
            {% if user.is_staff %}
                <a href="{% url 'gestionar_menus' %}" class="btn btn-outline-primary">
                    <i class="bi bi-gear me-1"></i>
                    {% trans "Gestionar Menús" %}
                </a>
            {% endif %}
        </div>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-lg-10 col-xl-11">
        <!-- Información de la empresa de catering -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i class="bi bi-info-circle me-2"></i>
                    {% trans "Empresa de Catering" %}
                </h5>
            </div>
            <div class="card-body">
                <div class="text-center mb-4">
                    <h4 class="text-primary">{{ menu_info.empresa }}</h4>
                    <p class="text-muted">{{ menu_info.descripcion }}</p>
                </div>

                <hr>

                <div class="row text-center">
                    <div class="col-md-12 mb-3">
                        <h6 class="text-primary mb-3">
                            <i class="bi bi-info-circle me-1"></i>
                            {% trans "Información de Contacto" %}
                        </h6>
                        
                        <div class="d-flex justify-content-center flex-wrap gap-4">
                            <div class="text-center">
                                <i class="bi bi-envelope fs-4 text-primary mb-2 d-block"></i>
                                <a href="mailto:{{ menu_info.contacto_empresa.email }}" class="text-decoration-none">
                                    {{ menu_info.contacto_empresa.email }}
                                </a>
                            </div>
                            
                            <div class="text-center">
                                <i class="bi bi-globe fs-4 text-primary mb-2 d-block"></i>
                                <a href="https://{{ menu_info.contacto_empresa.web }}" target="_blank" class="text-decoration-none">
                                    {{ menu_info.contacto_empresa.web }}
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Menú del mes -->
        <div class="card shadow-sm">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="bi bi-calendar-week me-2"></i>
                    {% trans "Menú del Mes" %} - {{ menu_info.mes_actual }}
                </h5>
            </div>
            <div class="card-body">
                <div class="text-center mb-4">
                    <p class="text-muted">{% trans "Consulta el menú más reciente del comedor escolar en tu idioma preferido" %}</p>
                    {% if menu_info.menus_disponibles.0.archivo != 'no_disponible.pdf' %}
                        <div class="d-flex justify-content-center align-items-center gap-3 flex-wrap">
                            <span class="badge bg-success">
                                <i class="bi bi-check-circle me-1"></i>
                                {% trans "Menús actualizados automáticamente" %}
                            </span>
                            {% if menu_info.fecha_actualizacion %}
                                <small class="text-muted">
                                    <i class="bi bi-clock me-1"></i>
                                    {% trans "Última actualización" %}: {{ menu_info.fecha_actualizacion }}
                                </small>
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="alert alert-warning mt-3">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            {% trans "No hay menús disponibles actualmente. Los menús se actualizarán automáticamente cuando estén disponibles." %}
                        </div>
                    {% endif %}
                </div>
                
                {% if menu_info.menus_disponibles.0.archivo != 'no_disponible.pdf' %}
                <!-- Pestañas para los diferentes idiomas -->
                <ul class="nav nav-tabs" id="menuTabs" role="tablist">
                    {% for menu in menu_info.menus_disponibles %}
                    <li class="nav-item" role="presentation">
                        <button class="nav-link {% if forloop.first %}active{% endif %}" 
                                id="tab-{{ forloop.counter }}" 
                                data-bs-toggle="tab" 
                                data-bs-target="#menu-{{ forloop.counter }}" 
                                type="button" role="tab">
                            <i class="bi bi-file-earmark-pdf me-2"></i>
                            {{ menu.idioma }}
                        </button>
                    </li>
                    {% endfor %}
                </ul>

                <div class="tab-content" id="menuTabsContent">
                    {% for menu in menu_info.menus_disponibles %}
                    <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" 
                         id="menu-{{ forloop.counter }}" 
                         role="tabpanel">
                        
                        <div class="text-center py-3">
                            <h6>{{ menu.titulo }}</h6>
                            <a href="{% url 'serve_pdf' filename=menu.archivo %}" 
                               target="_blank" 
                               class="btn btn-danger btn-lg mb-3">
                                <i class="bi bi-file-earmark-pdf me-2"></i>
                                {% trans "Abrir PDF" %} ({{ menu.idioma }})
                            </a>
                        </div>

                        <!-- Visualización del PDF embebido -->
                        <div class="ratio ratio-4x3">
                            <iframe src="{% url 'serve_pdf' filename=menu.archivo %}#toolbar=0&navpanes=0&scrollbar=1&zoom=FitH&view=FitH" 
                                    class="pdf-iframe" 
                                    title="{{ menu.titulo }}"
                                    loading="lazy">
                                <p>{% trans "Tu navegador no soporta la visualización de PDFs. " %}
                                   <a href="{% url 'serve_pdf' filename=menu.archivo %}" target="_blank">{% trans "Haz clic aquí para descargarlo" %}</a>
                                </p>
                            </iframe>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                <div class="text-center mt-3">
                    <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i>
                        {% trans "Si no puedes ver el menú, ábrelo en una nueva pestaña haciendo clic en el botón superior" %}
                    </small>
                </div>

                <div class="row text-center mt-4">
                    <div class="col-md-4 mb-3">
                        <div class="p-3 bg-light rounded">
                            <i class="bi bi-cup-hot display-4 text-warning mb-2"></i>
                            <h6>{% trans "Comida Casera" %}</h6>
                            <small class="text-muted">{% trans "Elaborada diariamente" %}</small>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="p-3 bg-light rounded">
                            <i class="bi bi-heart-pulse display-4 text-success mb-2"></i>
                            <h6>{% trans "Nutricionalmente Equilibrado" %}</h6>
                            <small class="text-muted">{% trans "Supervisado por nutricionistas" %}</small>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="p-3 bg-light rounded">
                            <i class="bi bi-leaf display-4 text-success mb-2"></i>
                            <h6>{% trans "Ingredientes Frescos" %}</h6>
                            <small class="text-muted">{% trans "De temporada y locales" %}</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}